<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Il Capitano • Pesca Nautica</title>

<style>
:root{
  --ink:#141414;
  --sea:#0b5f76;
  --sand:#f2e7c9;
  --line:rgba(0,0,0,.14);
  --bg:#fbfaf6;
  --r:16px;
  --shadow:0 18px 40px rgba(0,0,0,.12);
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  background:var(--bg);
  color:var(--ink);
}
a{text-decoration:none;color:inherit}
.wrap{max-width:1200px;margin:0 auto;padding:0 18px}

/* ===== HEADER ===== */
header{
  background:#fff;
  border-bottom:1px solid var(--line);
}
.headerRow{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:16px 0;
}
.logo{
  font-weight:1000;
  font-size:28px;
  letter-spacing:.02em;
}
.mobileBtn{
  display:none;
  font-size:26px;
  cursor:pointer;
}

/* ===== CATBAR ===== */
.catbar{
  background:#2b2b2b;
  color:#fff;
  position:sticky;
  top:0;
  z-index:1000;
}
.catbarInner{
  display:flex;
  gap:18px;
}
.catItem{
  position:relative;
  padding:14px 10px;
  font-weight:900;
  cursor:pointer;
}
.catItem:hover{
  background:rgba(255,255,255,.08);
}

/* ===== MEGA MENU ===== */
.mega{
  display:none;
  position:absolute;
  left:0;
  top:100%;
  width:100%;
  background:#fff;
  color:#000;
  box-shadow:var(--shadow);
  padding:22px;
}
.catItem:hover .mega{display:block}

.megaTop{
  display:flex;
  gap:12px;
  align-items:center;
  margin-bottom:14px;
}
.megaTop input{
  flex:1;
  padding:10px 12px;
  border-radius:12px;
  border:1px solid rgba(0,0,0,.16);
  font-weight:800;
}
.megaGrid{
  display:grid;
  grid-template-columns:repeat(2,minmax(0,1fr));
  gap:20px;
}
.megaCol h4{
  margin:0 0 8px;
  font-size:13px;
  text-transform:uppercase;
  letter-spacing:.08em;
  color:var(--sea);
}
.megaCol a{
  display:flex;
  justify-content:space-between;
  padding:6px 0;
  font-weight:800;
  font-size:14px;
}
.megaCol a:hover{color:var(--sea)}
.topTag{
  background:rgba(11,95,118,.12);
  color:var(--sea);
  font-size:11px;
  padding:2px 6px;
  border-radius:999px;
}

/* ===== MOBILE ===== */
@media(max-width:900px){
  .catbarInner{display:none}
  .mobileBtn{display:block}
}
.mobileMenu{
  display:none;
  position:fixed;
  inset:0;
  background:#fff;
  z-index:2000;
  overflow:auto;
  padding:20px;
}
.mobileMenu.open{display:block}
.mobileSearch input{
  width:100%;
  padding:10px 12px;
  border-radius:12px;
  border:1px solid rgba(0,0,0,.16);
  margin-bottom:14px;
}
.mobileSection{
  border-bottom:1px solid var(--line);
}
.mobileHead{
  display:flex;
  justify-content:space-between;
  padding:14px 0;
  font-weight:900;
}
.mobileList{display:none;padding-bottom:10px}
.mobileSection.open .mobileList{display:block}
.mobileList a{
  display:block;
  padding:6px 0;
  font-weight:800;
}

/* ===== CATALOGO ===== */
.catalog{padding:30px 0}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
  gap:16px;
}
.card{
  background:#fff;
  border:1px solid var(--line);
  border-radius:var(--r);
  padding:12px;
}
.price{
  margin-top:6px;
  font-weight:900;
  color:var(--sea);
}
</style>
</head>

<body>

<header>
  <div class="wrap headerRow">
    <div class="logo">Il Capitano</div>
    <div class="mobileBtn" onclick="openMobile()">☰</div>
  </div>
</header>

<nav class="catbar">
  <div class="wrap catbarInner" id="catbar"></div>
</nav>

<div class="mobileMenu" id="mobileMenu"></div>

<main class="wrap catalog">
  <h2>Vetrina Prodotti</h2>
  <section class="grid" id="grid"></section>
</main>

<script>
const DATA_URL="data/products.json";
const grid=document.getElementById("grid");
const catbar=document.getElementById("catbar");
const mobileMenu=document.getElementById("mobileMenu");

/* ===== STRUTTURA UX ===== */
const STRUCTURE={
  "Pesca":[
    "ACCESSORI  PESCA","ARTIFICIALI","NYLON E TRECCIATI","CANNE DA PESCA",
    "TOTANARA","AMI","MULINELLI","ACCESSORI TRAINA"
  ],
  "Sub":[
    "ACCESSORI SUBACQUEI","ATTREZZATURE SUBACQUEE","ACQUA SPORT"
  ],
  "Abbigliamento":[
    "ABBIGLIAMENTO","FODERI E BORSE","BORSE TENUTA STAGNA"
  ],
  "Nautica":[
    "ACCESSORI NAUTICI","ORMEGGIO ANCORAGGIO","FERRAMENTA NAUTICA",
    "DOTAZIONI DI SICUREZZA","DOTAZIONI BALNEARI"
  ],
  "Manutenzione":[
    "VITERIA ACCIAIO INOX A4","CORDE E TRECCIE",
    "ANTIVEGETATIVE E SMALTI","DETERGENTI/LUCIDANTI E PROTETTIVI"
  ],
  "Varie":[
    "PRONTO SOCCORSO","COLTELLI E FORBICI","OGGETTISTICA NAUTICA"
  ]
};

function norm(s){
  return String(s??"").replace(/\s+/g," ").trim().toUpperCase();
}

/* ===== LOAD DATA ===== */
let ALL=[];
fetch(DATA_URL).then(r=>r.json()).then(data=>{
  ALL=data.filter(r=>r["Cod."]).map(r=>({
    title:r["Descrizione"],
    category:r["Categoria"],
    price:r["Listino 1 (ivato)"]||"—"
  }));
  render(ALL);
  buildMenus();
});

function render(list){
  grid.innerHTML=list.map(p=>`
    <div class="card">
      <strong>${p.title}</strong>
      <div>${p.category}</div>
      <div class="price">${p.price}</div>
    </div>
  `).join("");
}

function filterCat(m){
  render(ALL.filter(p=>p.category.startsWith(m)));
}

/* ===== MENUS ===== */
function buildMenus(){
  // desktop
  for(const [section,macros] of Object.entries(STRUCTURE)){
    const item=document.createElement("div");
    item.className="catItem";
    item.textContent=section;

    const mega=document.createElement("div");
    mega.className="mega";

    const top=document.createElement("div");
    top.className="megaTop";
    top.innerHTML=`<input placeholder="Cerca in ${section}...">`;

    const grid=document.createElement("div");
    grid.className="megaGrid";

    const half=Math.ceil(macros.length/2);
    [macros.slice(0,half),macros.slice(half)].forEach(col=>{
      const c=document.createElement("div");
      c.className="megaCol";
      c.innerHTML=`<h4>${section}</h4>`+col.map(m=>`
        <a href="#" onclick="filterCat('${m}')">${m}</a>
      `).join("");
      grid.appendChild(c);
    });

    mega.appendChild(top);
    mega.appendChild(grid);
    item.appendChild(mega);
    catbar.appendChild(item);
  }

  // mobile
  mobileMenu.innerHTML=`<h3>Categorie</h3><div class="mobileSearch"><input placeholder="Cerca categoria..."></div>`;
  for(const [section,macros] of Object.entries(STRUCTURE)){
    const s=document.createElement("div");
    s.className="mobileSection";
    s.innerHTML=`<div class="mobileHead">${section}<span>+</span></div>
      <div class="mobileList">${macros.map(m=>`
        <a href="#" onclick="filterCat('${m}');closeMobile()">${m}</a>
      `).join("")}</div>`;
    s.querySelector(".mobileHead").onclick=()=>s.classList.toggle("open");
    mobileMenu.appendChild(s);
  }
}

function openMobile(){mobileMenu.classList.add("open")}
function closeMobile(){mobileMenu.classList.remove("open")}
</script>

</body>
</html>
